{"version":3,"file":"test-battle-records-pJerU6XI.js","sources":["../../../src/views/account/test-battle-records.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-card>\r\n      <template #header>\r\n        <div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n          <span>测试战斗记录</span>\r\n          <div class=\"filter-section\">\r\n            <el-form :inline=\"true\">\r\n              <el-form-item label=\"胜场\">\r\n                <el-input-number \r\n                  v-model=\"filterParams.wins\" \r\n                  :min=\"0\"\r\n                  placeholder=\"胜场数\"\r\n                />\r\n              </el-form-item>\r\n              <el-form-item label=\"负场\">\r\n                <el-input-number \r\n                  v-model=\"filterParams.loses\" \r\n                  :min=\"0\"\r\n                  placeholder=\"负场数\"\r\n                />\r\n              </el-form-item>\r\n              <el-form-item label=\"玩家ID\">\r\n                <el-input-number \r\n                  v-model=\"filterParams.playerId\" \r\n                  :min=\"0\"\r\n                  placeholder=\"玩家ID\"\r\n                />\r\n              </el-form-item>\r\n              <el-form-item>\r\n                <el-button type=\"primary\" @click=\"handleSearch\">搜索</el-button>\r\n                <el-button @click=\"resetFilter\">重置</el-button>\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </div>\r\n      </template>\r\n\r\n      <el-table\r\n        v-loading=\"loading\"\r\n        :data=\"paginatedData\" \r\n        style=\"width: 100%\"\r\n        :max-height=\"'70vh'\"\r\n      >\r\n      <!-- <el-table-column label=\"Operations\" width=\"150\">\r\n            <template #default=\"{ row }\">\r\n              <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(row)\">\r\n                Edit\r\n              </el-button>\r\n              <el-button type=\"danger\" size=\"small\" @click=\"handleDelete(row)\">\r\n                Delete\r\n              </el-button>\r\n            </template>\r\n          </el-table-column> -->\r\n\r\n        <el-table-column\r\n          prop=\"BattleCharacterRecordId\"\r\n          label=\"ID\"\r\n          width=\"80\"\r\n        />\r\n        <el-table-column\r\n          prop=\"CharacterDesignId\"\r\n          label=\"CharacterDesign\"\r\n          width=\"150\"\r\n        />\r\n        <el-table-column\r\n          prop=\"CharacterName\"\r\n          label=\"Name\"\r\n          width=\"150\"\r\n          >\r\n          <template #header=\"{ column }\">\r\n                <div class=\"column-header\">\r\n                  <div class=\"header-title\">\r\n                    CharacterName\r\n                  </div>\r\n                  <el-input\r\n                    v-model=\"columnFilters['CharacterName']\"\r\n                    size=\"small\"\r\n                    placeholder=\"Search\"\r\n                    @input=\"handleColumnFilter\"\r\n                    @click.stop\r\n                  />\r\n                </div>\r\n              </template>\r\n        </el-table-column>\r\n    \r\n\r\n        <el-table-column\r\n          prop=\"Score\"\r\n          label=\"Score(WinCount)\"\r\n          width=\"180\"\r\n        />\r\n\r\n        <el-table-column\r\n          prop=\"CharacterBattleLevel\"\r\n          label=\"BattleLevel\"\r\n          width=\"180\"\r\n        />\r\n        <el-table-column\r\n          prop=\"SessionBattleIndex\"\r\n          label=\"BattleIndex\"\r\n          width=\"180\"\r\n        />\r\n         <el-table-column label=\"AIGraph\" width=\"150\">\r\n            <template #default=\"{ row }\">\r\n              <el-button type=\"primary\" size=\"small\" @click=\"showAIGraph(row)\">\r\n                Show\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        <el-table-column label=\"Operations\" width=\"150\" fixed=\"right\">\r\n          <template #default=\"{ row }\">\r\n            <el-button type=\"primary\" size=\"small\" @click=\"handleEdit(row)\">\r\n              Edit\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"Assign To Session\" width=\"150\" fixed=\"right\">\r\n          <template #default=\"{ row }\">\r\n            <el-button type=\"primary\" size=\"small\" @click=\"assignToSession(row)\">\r\n              Assign\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div class=\"pagination-container\">\r\n        <el-pagination\r\n          v-model:current-page=\"currentPage\"\r\n          v-model:page-size=\"pageSize\"\r\n          :total=\"total\"\r\n          :page-sizes=\"[50]\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n        />\r\n      </div>\r\n\r\n    </el-card>\r\n\r\n    <el-dialog\r\n          :title=\"'AI Graph Json'\"\r\n          v-model=\"aiGraphVisible\"\r\n          width=\"60vw\"\r\n        >\r\n          {{ currentAIJson }}\r\n          <template #footer>\r\n            <el-button @click=\"aiGraphVisible = false\">Cancel</el-button>\r\n            <!-- <el-button type=\"primary\" @click=\"handleSaveAI\">Save</el-button> -->\r\n          </template>\r\n        </el-dialog>\r\n\r\n    <el-dialog\r\n      :title=\"'Edit Record'\"\r\n      v-model=\"dialogVisible\"\r\n      width=\"60%\"\r\n    >\r\n      <el-form v-if=\"currentRecord\" :model=\"currentRecord\" label-width=\"140px\">\r\n        <el-form-item label=\"CharacterName\">\r\n          <el-input v-model=\"currentRecord.CharacterName\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"CharacterDesignId\">\r\n          <el-input v-model=\"currentRecord.CharacterDesignId\" type=\"number\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"Score\">\r\n          <el-input v-model=\"currentRecord.Score\" type=\"number\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"CharacterBattleLevel\">\r\n          <el-input v-model=\"currentRecord.CharacterBattleLevel\" type=\"number\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"SessionBattleIndex\">\r\n          <el-input v-model=\"currentRecord.SessionBattleIndex\" type=\"number\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"AIGraphJson\">\r\n          <el-input v-model=\"currentRecord.AIGraphJson\" type=\"textarea\" :rows=\"4\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      \r\n      <template #footer>\r\n        <el-button @click=\"dialogVisible = false\">Cancel</el-button>\r\n        <el-button type=\"primary\" @click=\"handleSave\">Save</el-button>\r\n      </template>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { ref, onMounted, computed } from 'vue'\r\nimport { assignRecordToSession, queryTestBattleRecord, upsertTestRecord } from '@/api/account'\r\nimport type { HWBattleCharacterRecord } from '@/shared_models/generated/HWBattleCharacterRecord'\r\n\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { Search, CaretTop, CaretBottom } from '@element-plus/icons-vue'\r\nimport type { QueryTestBattleRecordResponse, UpsertTestBattleRecordRequest, QueryTestBattleRecordRequest } from '@/types/api'\r\n\r\ninterface FormData {\r\n  [key: string]: any\r\n}\r\n\r\ninterface TableItem {\r\n  [key: string]: any\r\n}\r\n\r\nconst columnFilters = ref<Record<string, string>>({})\r\nconst aiGraphVisible = ref(false)\r\nconst currentAIJson = ref('')\r\n\r\nconst loading = ref(false)\r\nconst records = ref<HWBattleCharacterRecord[]>([])\r\n\r\nconst currentPage = ref(1)\r\nconst pageSize = ref(50)\r\n\r\nconst dialogVisible = ref(false)\r\nconst currentRecord = ref<HWBattleCharacterRecord | null>(null)\r\n\r\nconst total = ref(0)\r\nconst filterParams = ref<QueryTestBattleRecordRequest>({\r\n  wins: null,\r\n  loses: null,\r\n  playerId: null,\r\n  skip: 0\r\n})\r\n\r\nconst fetchRecords = async () => {\r\n  loading.value = true\r\n  try {\r\n    const request: QueryTestBattleRecordRequest = {\r\n      ...filterParams.value,\r\n      skip: (currentPage.value - 1) * pageSize.value\r\n    }\r\n    \r\n    const res = await queryTestBattleRecord(request)\r\n    records.value = res.records\r\n    total.value = res.total // 注意：需要后端API返回总数\r\n  } catch (error) {\r\n    console.error('获取测试战斗记录失败:', error)\r\n    ElMessage.error('获取记录失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst handleSearch = () => {\r\n  currentPage.value = 1\r\n  fetchRecords()\r\n}\r\n\r\nconst resetFilter = () => {\r\n  filterParams.value = {\r\n    wins: null,\r\n    loses: null,\r\n    playerId: null,\r\n    skip: 0\r\n  }\r\n  currentPage.value = 1\r\n  fetchRecords()\r\n}\r\n\r\nconst handleAdd = () => {\r\n//   form.value = {}\r\n//   dialogTitle.value = 'Add New Row'\r\n//   dialogVisible.value = true\r\n}\r\n\r\nconst handleEdit = (row: HWBattleCharacterRecord) => {\r\n  currentRecord.value = { ...row }\r\n  dialogVisible.value = true\r\n}\r\n\r\nconst showAIGraph = (row: any) => {\r\n    aiGraphVisible.value = true;\r\n    currentAIJson.value = row[\"AIGraphJson\"]\r\n}\r\n\r\nconst handleDelete = (row: any) => {\r\n//   ElMessageBox.confirm('Are you sure to delete this row?', 'Warning', {\r\n//     confirmButtonText: 'Yes',\r\n//     cancelButtonText: 'Cancel',\r\n//     type: 'warning'\r\n//   }).then(async () => {\r\n//     console.log(`${designName.value}Id`.replace(\"HW\",\"\"))\r\n//     try {\r\n//       await deleteDesignRow({\r\n//         designName: designName.value,\r\n//         designId: row[`${designName.value}Id`.replace(\"HW\",\"\")]\r\n//       })\r\n//       ElMessage.success('Delete successfully')\r\n//       loadData()\r\n//     } catch (error) {\r\n//       console.error(error)\r\n//       ElMessage.error('Delete failed')\r\n//     }\r\n//   })\r\n}\r\n\r\nconst assignToSession = (row: any) => {\r\n  ElMessageBox.confirm('Are you sure to assign this record to system session?', 'Warning', {\r\n    confirmButtonText: 'Yes',\r\n    cancelButtonText: 'Cancel',\r\n    type: 'warning'\r\n  }).then(async () => {\r\n   \r\n    try {\r\n      await assignRecordToSession({\r\n        recordId: row.BattleCharacterRecordId\r\n      })\r\n    \r\n    } catch (error) {\r\n      console.error(error)\r\n      ElMessage.error('Assign failed')\r\n    }\r\n  })\r\n}\r\n// 处理列过滤\r\nconst handleColumnFilter = () => {\r\n  // 过滤逻辑已在 computed 中处理\r\n}\r\n\r\n\r\nconst handleSave = async () => {\r\n  if (!currentRecord.value) return\r\n  \r\n  try {\r\n    const request: UpsertTestBattleRecordRequest = {\r\n      record: currentRecord.value\r\n    }\r\n    \r\n    await upsertTestRecord(request)\r\n    ElMessage.success('保存成功')\r\n    dialogVisible.value = false\r\n    fetchRecords() // 刷新数据\r\n  } catch (error) {\r\n    console.error('保存失败:', error)\r\n    ElMessage.error('保存失败')\r\n  }\r\n}\r\n\r\nconst filteredTableData = computed(() => {\r\n  let result: HWBattleCharacterRecord[] = [...records.value]\r\n  \r\n  Object.entries(columnFilters.value).forEach(([prop, filterValue]) => {\r\n    if (filterValue) {\r\n      result = result.filter(item => {\r\n        const value = (item as any)[prop]\r\n        \r\n        if (typeof value === 'number') {\r\n          return value.toString().includes(filterValue)\r\n        }\r\n        if (typeof value === 'string') {\r\n          return value.toLowerCase().includes(filterValue.toLowerCase())\r\n        }\r\n        return false\r\n      })\r\n    }\r\n  })\r\n  \r\n  return result\r\n})\r\n\r\n// 添加分页后的数据计算属性\r\nconst paginatedData = computed(() => records.value)\r\n\r\n// 添加分页处理方法\r\nconst handleSizeChange = (val: number) => {\r\n  pageSize.value = val\r\n  currentPage.value = 1\r\n  fetchRecords()\r\n}\r\n\r\nconst handleCurrentChange = (val: number) => {\r\n  currentPage.value = val\r\n  fetchRecords()\r\n}\r\n\r\nonMounted(() => {\r\n//   handleSearch()\r\n})\r\n</script> \r\n\r\n<style scoped>\r\n.column-header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 8px;\r\n}\r\n.header-title {\r\n  margin-bottom: 4px;\r\n}\r\n.filter-section {\r\n  margin-bottom: 16px;\r\n}\r\n.pagination-container {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: flex-end;\r\n}\r\n</style> "],"names":["columnFilters","ref","aiGraphVisible","currentAIJson","loading","records","currentPage","pageSize","dialogVisible","currentRecord","total","filterParams","fetchRecords","request","res","queryTestBattleRecord","error","ElMessage","handleSearch","resetFilter","handleEdit","row","showAIGraph","assignToSession","ElMessageBox","assignRecordToSession","handleColumnFilter","handleSave","upsertTestRecord","computed","result","prop","filterValue","item","value","paginatedData","handleSizeChange","val","handleCurrentChange","onMounted"],"mappings":"uiBA6MM,MAAAA,EAAgBC,EAA4B,EAAE,EAC9CC,EAAiBD,EAAI,EAAK,EAC1BE,EAAgBF,EAAI,EAAE,EAEtBG,EAAUH,EAAI,EAAK,EACnBI,EAAUJ,EAA+B,EAAE,EAE3CK,EAAcL,EAAI,CAAC,EACnBM,EAAWN,EAAI,EAAE,EAEjBO,EAAgBP,EAAI,EAAK,EACzBQ,EAAgBR,EAAoC,IAAI,EAExDS,EAAQT,EAAI,CAAC,EACbU,EAAeV,EAAkC,CACrD,KAAM,KACN,MAAO,KACP,SAAU,KACV,KAAM,CAAA,CACP,EAEKW,EAAe,SAAY,CAC/BR,EAAQ,MAAQ,GACZ,GAAA,CACF,MAAMS,EAAwC,CAC5C,GAAGF,EAAa,MAChB,MAAOL,EAAY,MAAQ,GAAKC,EAAS,KAC3C,EAEMO,EAAM,MAAMC,GAAsBF,CAAO,EAC/CR,EAAQ,MAAQS,EAAI,QACpBJ,EAAM,MAAQI,EAAI,YACXE,EAAO,CACN,QAAA,MAAM,cAAeA,CAAK,EAClCC,EAAU,MAAM,QAAQ,CAAA,QACxB,CACAb,EAAQ,MAAQ,EAAA,CAEpB,EAEMc,EAAe,IAAM,CACzBZ,EAAY,MAAQ,EACPM,EAAA,CACf,EAEMO,EAAc,IAAM,CACxBR,EAAa,MAAQ,CACnB,KAAM,KACN,MAAO,KACP,SAAU,KACV,KAAM,CACR,EACAL,EAAY,MAAQ,EACPM,EAAA,CACf,EAQMQ,EAAcC,GAAiC,CACrCZ,EAAA,MAAQ,CAAE,GAAGY,CAAI,EAC/Bb,EAAc,MAAQ,EACxB,EAEMc,EAAeD,GAAa,CAC9BnB,EAAe,MAAQ,GACTC,EAAA,MAAQkB,EAAI,WAC9B,EAuBME,EAAmBF,GAAa,CACvBG,GAAA,QAAQ,wDAAyD,UAAW,CACvF,kBAAmB,MACnB,iBAAkB,SAClB,KAAM,SAAA,CACP,EAAE,KAAK,SAAY,CAEd,GAAA,CACF,MAAMC,GAAsB,CAC1B,SAAUJ,EAAI,uBAAA,CACf,QAEML,EAAO,CACd,QAAQ,MAAMA,CAAK,EACnBC,EAAU,MAAM,eAAe,CAAA,CACjC,CACD,CACH,EAEMS,EAAqB,IAAM,CAEjC,EAGMC,EAAa,SAAY,CACzB,GAAClB,EAAc,MAEf,GAAA,CACF,MAAMI,EAAyC,CAC7C,OAAQJ,EAAc,KACxB,EAEA,MAAMmB,GAAiBf,CAAO,EAC9BI,EAAU,QAAQ,MAAM,EACxBT,EAAc,MAAQ,GACTI,EAAA,QACNI,EAAO,CACN,QAAA,MAAM,QAASA,CAAK,EAC5BC,EAAU,MAAM,MAAM,CAAA,CAE1B,EAE0BY,EAAS,IAAM,CACvC,IAAIC,EAAoC,CAAC,GAAGzB,EAAQ,KAAK,EAElD,cAAA,QAAQL,EAAc,KAAK,EAAE,QAAQ,CAAC,CAAC+B,EAAMC,CAAW,IAAM,CAC/DA,IACOF,EAAAA,EAAO,OAAeG,GAAA,CACvB,MAAAC,EAASD,EAAaF,CAAI,EAE5B,OAAA,OAAOG,GAAU,SACZA,EAAM,WAAW,SAASF,CAAW,EAE1C,OAAOE,GAAU,SACZA,EAAM,YAAY,EAAE,SAASF,EAAY,aAAa,EAExD,EAAA,CACR,EACH,CACD,EAEMF,CACR,CAAA,EAGD,MAAMK,EAAgBN,EAAS,IAAMxB,EAAQ,KAAK,EAG5C+B,EAAoBC,GAAgB,CACxC9B,EAAS,MAAQ8B,EACjB/B,EAAY,MAAQ,EACPM,EAAA,CACf,EAEM0B,EAAuBD,GAAgB,CAC3C/B,EAAY,MAAQ+B,EACPzB,EAAA,CACf,EAEA,OAAA2B,EAAU,IAAM,CAAA,CAEf"}